<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PRI - Persistent Request Intercept</title>
</head>
<body>
<button id="opener">Click me and I'll open a child</button>
<h4>Events</h4>
<ul id="list">

</ul>
</body>
<script src="pri.js"></script>
<script>
    var superDate   = (new Date()).toString(),
        opener      = document.getElementById('opener'),
        list        = document.getElementById('list'),
        title       = document.title,
        li,
        childWindow = null;

    opener.addEventListener('click', function() {
      pri.newWindow('child1.html', {
          allRequestsDone: function() {
            document.title = 'allRequestsDone was fired from child';
            setTimeout(function() {
              document.title = title;
            }, 5000);

            li = document.createElement('li');
            li.innerHTML = 'All XMLHttpRequests are done';
            list.appendChild(li);
          },
          beforeLoad: function(newWindow) {
            document.title = 'beforeLoad was fired from child';
            setTimeout(function() {
              document.title = title;
            }, 5000);

            li = document.createElement('li');
            li.innerHTML = 'You navigated to: ' + newWindow.location;
            list.appendChild(li);
          },
          close: function() {
            li = document.createElement('li');
            li.innerHTML = 'You closed a window';
            list.appendChild(li);
          }
        });
    });
</script>
</html>